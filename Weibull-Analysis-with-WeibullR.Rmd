---
title: "Weibull Analysis with WeibullR"
author: "Paul Govan"
date: "2023-03-21"
output: 
  ioslides_presentation:
    widescreen: true
    fig_width: 6
    fig_height: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The Weibull Distribution

The Weibull distribution is the most commonly used distribution in the field of life data analysis

Why? Because the Weibull is a **flexible** distribution and can fit many different types of data

## The Weibull Distribution {.smaller}

Take the following normal distribution

```{r}
x <- seq(0, 10, by = .1)
y <- dnorm(x, mean = 5, sd = 1)
plot(x,y, type = "l")
```

## The Weibull Distribution {.smaller}

The Weibull can *mimic* the normal and many others

```{r}
y <- dweibull(x, shape = 7.13, scale = 5.34)
plot(x,y, type = "l")
```

## The Cumulative Distribution Function

R(t) gives the cumulative probability of *survival* prior to time *t* while F(t) gives the cumulative probability of *failure* prior to time *t*

$$ R(t) = 1 - F(t) = e^-(t/\eta)^\beta $$

Where $\beta$ is the shape parameter. In life analysis $\beta$ has a physical interpretation:

- $\beta$ < 1 - the failure rate is decreasing (may indicate infant mortality)
- $\beta$ = 1 - the failure rate is constant (random failures or possible mix of failure modes)
- $\beta$ > 1 - the failure rate is increasing (may indicate wear out)

And $\eta$ is the scale parameter or the quantile at 63.2% probability

## The Weibull Parameters

Let's vary the parameters of the Weibull distribution to see these relationships graphically

## The Weibull Parameters {.smaller}

Varying Beta changes the shape of the cumulative distribution function

```{r}
x <- seq(0, 50, by = .1)
plot(pweibull(x, shape = 1, scale = 10), col = "blue", type = "l", xlab = "x", ylab = "y") 
lines(pweibull(x, shape = 2, scale = 10), col = "red") 
legend(150, 0.6, legend=c("shape = 1, scale = 10", "shape = 2, scale = 10"),col=c("blue", "red"), lty=1, cex=1.2)
```

## The Weibull Parameters {.smaller}

Varying Eta moves the weibull distribution along the x-axis

```{r}
x <- seq(0, 50, by = .1)
plot(pweibull(x, shape = 1, scale = 5), col = "blue", type = "l", xlab = "x", ylab = "y") 
lines(pweibull(x, shape = 1, scale = 10), col = "red") 
legend(150, 0.6, legend=c("shape = 1, scale = 5", "shape = 1, scale = 10"), col=c("blue", "red"), lty=1, cex=1.2)
```

## WeibullR

For this tutorial, we will use WeibullR: an R package for life data analysis in the tradition of Walodi Weibull 

First, check if WeibullR is installed in R and install if not

```{r message=FALSE}
if(!(require(WeibullR))){install.packages('WeibullR')}
```
Let's run a basic example using the quick fit method

```{r}
failures<-c(30, 49, 82, 90, 96)
fit<-MLEw2p(failures)
knitr::kable(fit, "html", col.names = "param")
```

## Right Censored Data

Right censored data includes **suspensions** or units that have operated for a period of time without failure

## Right Censored Data {.smaller}

Let's add right censored data to the previous example and build a basic probability plot 

```{r}
suspensions<-c(100, 45, 10)
fit<-MLEw2p(failures, suspensions, bounds=TRUE, show=TRUE)
```

## Interval Censored Data {.smaller}

Interval censored data is most commonly in the form of inspection data, where the failure occurred between two inspection times, the latest known working time (left entry), and the inspection time when the failure was detected (right entry)

To create an interval censored model, let's use the inspection data from Silkworth, 2020

```{r}
inspection_data<-data.frame(left=c(0, 6.12, 19.92, 29.64, 35.4, 39.72, 45.32, 52.32),
                            right=c(6.12, 19.92, 29.64, 35.4, 39.72, 45.32, 52.32, 63.48),
                            qty=c(5, 16, 12, 18, 18, 2, 6, 17))
```

Add suspension data for units surviving by the last inspection date

```{r}
suspensions<-data.frame(time=63.48, event=0, qty=73)
```

## Interval Censored Data {.smaller}

Add a fit and plot the results

```{r warning=FALSE}
obj1<-wblr(suspensions, interval = inspection_data)
obj1<-wblr.fit(obj1, method.fit="mle", col="red") 
plot(obj1)
```

## Grouped Data

Life data is often compiled into groups (i.e. a group of units failed or survived at a certain time)
Notice how the previous example contained groups in the `qty` column 
          
```{r results='asis'}
suspensions<-data.frame(time=63.48, event=0, qty=73)
knitr::kable(suspensions, "html")
```

## Maximum Likelihood vs Rank Regression

**Median Rank Regression (MRR)** is a least squares analysis based on minimizing the squared distance from the cumulative probability of the fitted model

**Maximum Likelihood Estimation (MLE)** is based on estimating the parameters of the distribution by maximizing the likelihood function of the observed data

WeibullR includes functions for both methods, such as the `MRRw2p`, `MRRw3p` functions for MRR and the `MLEw2p`, `MLEw3p` functions for MLE

## The WeiBayes Model

A WeiBayes or 1P Weibull has a fixed $\beta$ or shape parameter based on *prior* knowledge or experience

Weibayes models are typically used when failure data is limited

## The WeiBayes Model {.smaller}

Let's rerun the previous example as a WeiBayes model with a Beta of 2

```{r warning=FALSE}
y <- dnorm(x, mean = 5, sd = 1)
suspensions<-c(100, 45, 10)
eta <- weibayes(failures, suspensions, beta=2)
x <- seq(0, 200, by = .1)
plot(pweibull(x, shape = 2, scale = eta), col = "blue", type = "l", xlab = "Time to Failure", ylab = "Unreliability (%)") 
```

## The 3-Parameter Weibull Model

The 3P Weibull has an additional parameter *t~0~* to represent a failure free period (i.e. a component cannot fail until after time *t~0~*)

$$ R(t) = 1 - F(t) = e^-((t-t~0~)/\eta)^\beta $$

## The 3-Parameter Weibull Model {.smaller}

Let's rerun the previous example as a 3P Weibull

```{r}
failures<-c(30, 49, 82, 90, 96)
suspensions<-c(100, 45, 10)
fit<-MLEw3p(failures, suspensions, bounds=TRUE, show=TRUE)
```

## Multi-Plots

To build a plot with multiple Weibull models, start by creating a `wblr` object

```{r}
failures<-c(30, 49, 82, 90, 96)
obj1<-wblr(failures) 
```

Add a default fit that appears as a red line on the plot

```{r}
obj1<-wblr.fit(obj1, col="red") 
```

Add default confidence bounds using a single width line

```{r}
obj1<-wblr.conf(obj1, lwd=1) 
```

## Multi-Plots

Plot a chart of the wblr object

```{r}
plot(obj1)
```

## Multi-Plots

Now create a second `wblr` object

```{r}
failures<-c(30, 49, 82, 90, 96)
suspensions<-c(100, 45, 10)
obj2<-wblr.conf(wblr.fit(wblr(failures, suspensions, col="purple"),),lwd=1)
```

## Multi-Plots

Finally, add the `wblr` objects to a list and plot both objects in a single chart

```{r}
plot.wblr(list(obj1, obj2))
```

## How to Get Help

To get help with a specific function, type a question mark before the function name

```{r eval=FALSE}
?MRRw2p
```

For more help with the WeibullR package

```{r eval=FALSE}
help(package="WeibullR")
```

## References

Silkworth D, Symynck J (2022). _WeibullR: Weibull Analysis for Reliability Engineering_. R package version 1.2.1,
  <https://CRAN.R-project.org/package=WeibullR>.

Silkworth, David. (2020). WeibullR: An R Package for Weibull Analysis for Reliability Engineers. 43-53. 10.35566/isdsa2019c3. 
